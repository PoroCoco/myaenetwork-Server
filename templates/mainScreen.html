<!doctype html>
<head>
  <meta charset="utf-8">
  <title>MAEN</title>
  <link rel="stylesheet" type="text/css" href="static/styleBase.css">
  <script src="script.js"></script>
</head>
<body onload="sortTable(1)">
<div id ="main">
    <div id="mySidepanel" class="sidepanel">
      {%if energy %}
      <p class ="testP"style="text-align:left;">Currently Stored Power :<span style="float:right;">
        Average Energy Used : 
      </span></p>
      <p class ="testP" style="text-align:left;"><span id="energyStored">{{energy["storedPower"]/2}} Eu</span><span id="energyTick" style="float:right;">
        {{energy["avgPowerUsage"]/2}} Eu/t
      </span></p>
      <p class ="testP"style="text-align:left;">Maximum Stored Power :<span style="float:right;">
        Remaining Energy :
      </span></p>
      <p class ="testP"style="text-align:left;"><span id="energyStoredMax">{{energy["maxStoredPower"]/2}} Eu</span><span style="float:right;">
        0
      </span></p>
      <p><a id="rfToEu" href="javascript:void(0)" class="powerbtn" value="EU" onclick="switchEnergyDisplay()">Switch Power Unit</a></p>


      {%endif%}
      {%if cpus%}
      <table class = "cpuTable" id="CpusList" style="width:50%;margin-left: auto;margin-right: auto;" >
        <th>Cpu Name</th>
        <th>Processing Power</th>
        <th>Coprocessors</th>
        <th>State</th>
        {%for i in range (0,cpus|count)%}
              <tr>
                  <td>
                    {% if cpus[i]["name"] == "" %}
                      Unnamed
                    {%else%}
                      {{cpus[i]["name"]}}
                    {%endif%}
                  </td>
                  <td>
                    {{cpus[i]["storage"]}}
                  </td>
                  <td>
                    {{cpus[i]["coprocessors"]}}
                  </td>
                  <td>
                    {% if cpus[i]["busy"] == "true" %}
                        Working
                    {%else%}
                        Idle
                    {%endif%}
                  </td>
              </tr>
        {%endfor%}
      </table>
    {%endif%}
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
    </div>
    <button class="openbtn" onclick="openNav()">▼Network status</button> 
    {%if networkMessage %}
      <h2 class = "networkMessage"> {{networkMessage}}</h2>
    {%endif%}
    {%if adminMessage %}
      <h3 class = "adminMessage"> {{adminMessage}}</h3>
    {%endif%}
  <table style="width:100%;margin-left: auto;margin-right: auto; " >
    <th> <h1>Network Items</h1> </th>
    <th><h1>Crafting Request</h1></th>
    <tr>
  <td id="itemsTable" style="width:65%;margin-left: auto;margin-right: auto;" >
  {%if aeItems %}

  <input type="text" id="itemSearch" onkeyup="myFunction()" placeholder="Search for item" style="width: 65%;direction: ltr;">

      <table id="itemList" style="width:100%" >
          <th onclick="sortTable(0)" class ="thsort">Item Name</th>
          <th onclick="sortTable(1)" class ="thsort">Item Count</th>
          <th onclick="sortTable(2)" class ="thsort">Is Craftable</th>
          {%for key,value in aeItems.items() %}
              <tr class = "itemTr">
                      <td style="text-align: left;">
                          {{key}}
                      </td>
                  <td style="text-align: left;">{{value["size"]}}</td>
                  <td>
                    {% if value["isCraftable"] == "true"%}
                    <form action="craftingRequest">
                      <input type="number" name="number" placeholder="Request x amount" min="1" max="999999999"/>
                      <input type="hidden" name="itemName" value="{{key}}" />
                      <input type="submit" value="Request" />
                    </form>
                  </td>
                  {%endif%}
              </tr>
              
          {%endfor%}
      </table>


  {%endif%}
  </td>
  <td style="width:35%;margin-left: auto;margin-right: auto;vertical-align: baseline;">
  {%if craftingStatusData %}
    
  <table id="CraftingRequest" style="width:100%;" >
    <th>Item Name</th>
    <th>Item Count</th>
    <th>Status <br> (Canceled = Missing resources OR Cpus already occupied OR too complex for current Cpus</br></th>
    {%for i in range (craftingStatusData|count)%}
        <tr>
            <td style="text-align: left;">
              {{craftingStatusData[i][0]}}
            </td>
            <td style="text-align: left;">
              {{craftingStatusData[i][1]}}
            </td>
            <td>
              {{craftingStatusData[i][2]}}
            </td>
        </tr>

        
    {%endfor%}
  </table>

  {%endif%}
  </td>

  </tr>
</table>
</div>
<script>
    function myFunction() {
      var input, filter, table, tr, td, i, txtValue;
      input = document.getElementById("itemSearch");
      filter = input.value.toUpperCase();
      table = document.getElementById("itemList");
      tr = table.getElementsByTagName("tr");
      counterEvenOdd = 0

      for (i = 0; i < tr.length; i++) {
        td = tr[i].getElementsByTagName("td")[0];
        if (td) {
          txtValue = td.textContent || td.innerText;
          if (txtValue.toUpperCase().indexOf(filter) > -1) {
            tr[i].style.display = "";
            // if (counterEvenOdd % 2 == 0){
            //   tr[i].className = "rowOdd"
            // }else{
            //   tr[i].className = "rowEven"
            // }
            counterEvenOdd = counterEvenOdd +1
          } else {
            tr[i].style.display = "none";
          }
        }
      }
    }

  function openNav() {
    document.getElementById("mySidepanel").style.height = "350px";
    document.getElementById("main").style.marginTop = "350px";
  }

  function closeNav() {
    document.getElementById("mySidepanel").style.height = "0px";
    document.getElementById("main").style.marginTop = "0px";
  }

  function switchEnergyDisplay() {
    var btn = document.getElementById('rfToEu');
    var txtTick = document.getElementById('energyTick');
    var txtStored = document.getElementById('energyStored');
    var txtStoredMax = document.getElementById('energyStoredMax');
    if (btn.value === 'EU') {
      btn.value = 'RF';
      txtTick.textContent = '{{(energy["avgPowerUsage"]/2)}} EU/t';
      txtStored.textContent = '{{energy["storedPower"]/2}} EU';
      txtStoredMax.textContent = '{{energy["maxStoredPower"]/2}} EU';
    } else {
      btn.value = 'EU';
      txtTick.textContent = '{{(energy["avgPowerUsage"]/2)* 4}} RF/t';
      txtStored.textContent = '{{(energy["storedPower"]/2)* 4}} RF';
      txtStoredMax.textContent = '{{(energy["maxStoredPower"]/2)* 4}} RF';
    }
  }

  function sortTable(n) {
    var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
    table = document.getElementById("itemList");
    switching = true;
    // Set the sorting direction to ascending:
    dir = "desc";
    /* Make a loop that will continue until
    no switching has been done: */
    while (switching) {
      // Start by saying: no switching is done:
      switching = false;
      rows = table.rows;
      /* Loop through all table rows (except the
      first, which contains table headers): */
      for (i = 1; i < (rows.length - 1); i++) {
        // Start by saying there should be no switching:
        shouldSwitch = false;
        /* Get the two elements you want to compare,
        one from current row and one from the next: */
        x = rows[i].getElementsByTagName("TD")[n];
        y = rows[i + 1].getElementsByTagName("TD")[n];
        /* Check if the two rows should switch place,
        based on the direction, asc or desc: */
        if (dir == "asc") {
          if (n == 1) {
            if (Number(x.innerHTML) > Number(y.innerHTML)) {
            // If so, mark as a switch and break the loop:
            shouldSwitch = true;
            break;
            }
          }else{
            if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
            // If so, mark as a switch and break the loop:
            shouldSwitch = true;
            break;
            }
          }
          
        } else if (dir == "desc") {
          if (n == 1) {
            if (Number(x.innerHTML) < Number(y.innerHTML)) {
            // If so, mark as a switch and break the loop:
            shouldSwitch = true;
            break;
            }
          }else{
            if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
            // If so, mark as a switch and break the loop:
            shouldSwitch = true;
            break;
            }
          }
        }
      }
      if (shouldSwitch) {
        /* If a switch has been marked, make the switch
        and mark that a switch has been done: */
        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
        switching = true;
        // Each time a switch is done, increase this count by 1:
        switchcount ++;
      } else {
        /* If no switching has been done AND the direction is "asc",
        set the direction to "desc" and run the while loop again. */
        if (switchcount == 0 && dir == "desc") {
          dir = "asc";
          switching = true;
        }
      }
    }
  }
</script>

</body>
</html>